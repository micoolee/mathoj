<view>
  <map bindtap="mapclick" id="map" circles="{{circles}}" scale="{{scale}}" controls="{{role=='student'?stucontrols:controls}}" bindcontroltap="controltap" markers="{{markers}}" longitude='{{longitude}}' latitude='{{latitude}}' bindmarkertap="markertap" bindregionchange="regionchange" show-location style="width: 100%; height:{{mapheightratio*height}}px;"></map>
  <cover-view wx:if="{{showchangecircle}}" class="t_w" style="position: fixed;top: 0px;width: 100%;">
    <cover-view class="tanchu_view">
      <cover-view class="filterbutton" style="display: flex;">
        <cover-view style="flex:1;text-align: center;align-self: center;">距离</cover-view>
        <cover-view style="flex:6;display: flex;">
          <cover-view bindtap="switchmargin" data-id="3" class="circleborder margin510 {{filtermargin==3?'bluewhite':''}}">
            三公里
          </cover-view>
          <cover-view bindtap="switchmargin" data-id="5" class="circleborder margin510 {{filtermargin==5?'bluewhite':''}}">
            五公里
          </cover-view>
          <cover-view bindtap="switchmargin" data-id="0" class="circleborder margin510 {{filtermargin==0?'bluewhite':''}}">
            不限
          </cover-view>
        </cover-view>
      </cover-view>
      <cover-view style="display: flex;padding: 10px;height: 60rpx">
        <button style="width: 100px;" size="mini" bindtap="conceal">取消</button>
        <button style="width: 100px;" type="primary" size="mini" bindtap="confirmfilter">确认</button>
      </cover-view>
    </cover-view>
  </cover-view>
</view>
<view wx:if="{{mapheightratio!=1}}" style="height:{{1-mapheightratio}}">
  <view class="bottomline pingjun" style="padding: 40rpx;width: 80%;margin-left: 5%;">
    <view style="font-size:30rpx;display: flex;align-items: center;">
      <view wx:if="{{(profile.role!='school')}}">
        <image style="height: 80rpx;width: 80rpx;border-radius: 50%;" src="{{profile.avatar}}" />
      </view>
      <text style="margin-left: 20rpx;">{{profile.nickname}}</text>
    </view>
    <!-- 如果访问者是学生，增加申请加入退出的按钮 -->
    <view wx:if="{{role=='student'}}">
      <view wx:if="{{profile.schoolid != joinedschoolid}}" data-schoolid="{{profile.schoolid}}" style="margin-left: 20rpx;align-self: center;" bindtap="joinschool">
        申请加入
      </view>
      <view wx:else data-schoolid="{{profile.schoolid}}" style="margin-left: 20rpx;align-self: center;" bindtap="exitschool">
        申请退出
      </view>
    </view>
    <!-- 如果看的是机构的资料 -->
    <view style="font-size:20rpx" wx:if="{{(profile.role=='school')&&profile.phone!=undefined}}">
      <text style="margin-left: 20rpx;align-self: center;">{{profile.phone}}</text>
      <icon bindtap="callphone" class='mathoj mathojdianhua' style='color:gray;font-size:60rpx;'></icon>
      <icon bindtap="copyphone" class='mathoj mathojfuzhi' style='color:gray;font-size:60rpx;'></icon>
    </view>
  </view>
  <!-- 如果看的是机构的资料 -->
  <view class="czlist" style="padding: 40rpx;" wx:if="{{profile.role=='school'}}">
    <text style="margin-left: 20rpx;">校长：{{principal.nickname}} {{principal.phone}}</text>
    <text style="margin-left: 20rpx;">机构地址：{{profile.schooladdress}}</text>
    <text style="margin-left: 20rpx;">机构简介：{{profile.schooldesc}}</text>
  </view>
  <!-- 如果看的是学生的资料 -->
  <view class="czlist" style="padding: 0 40rpx;">
    <view wx:for="{{problems}}" wx:key="{{item.problemid}}" wx:for-index="idx" wx:for-item="item">
      <view class="feed-item" data-id='{{item.problemid}}' bindtap="bindQueTap">
        <view class="feed-source" style='display:flex;justify-content: space-between;'>
          <view class="answer-body">
            <view class="answer-actions" data-id='{{item.problemid}}' bindtap="bindQueTap">
              <text>{{item.asktime}}提问</text>
            </view>
          </view>
          <text wx:if="{{item.timeremain=='可回答'}}">{{item.timeremain}}</text>
          <text wx:else style="color:red">{{item.timeremain}}</text>
        </view>
        <view class="feed-content">
          <view class="question">
            <a class="question-link">
              <text class='line-3'>{{item.description}}</text>
            </a>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>